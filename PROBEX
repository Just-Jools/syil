(PROBEX)
(Description: Probe in X from the left or right side)
(Initial Coding: Justin Gray)
(Modified 1/14/2024: Joshua Smith)
(Simplified WCS extended number math, added probe error checking, added probe distance argument)
(Argument A -> #1 is the work coordinate system to store offsets in. The format for extended G54 offsets would be a period followed by the offset(G54.5))
(Argument B -> #2 is the desired probing distance. Enter a positive value to probe on the left side and a negative value to probe on the right side)

(load probe config)
G65 "PROBECONFIG"

(important local variables)
#100 = @100             (TOOL NUMBER PROVIDED BY PROBECONFIG MACRO)
#110 = @103             (FEED SPEED PROVIDED BY PROBECONFIG MACRO)
#111 = @104             (FAST PROBE SPEED PROVIDED BY PROBECONFIG MACRO)
#112 = @105             (SLOW PROBE SPEED PROVIDED BY PROBECONFIG MACRO)
#105 = @102             (TOOL RADIUS PROVIDED BY PROBECONFIG MACRO)
#108 = @108             (PROBE BACKOFF DISTANCE PROVIDED BY PROBECONFIG MACRO)


(CALCULATE EXTENDED WCS NUMBER)
(FIX is a round down function and MOD is modulo)
#114 = MOD[#1,FIX[#1]]*10 

(Probe X the desired distance and at fast feed)
G31 G91 P2 X[#2] F#111        

(Check that the probe has triggered)
IF[R_SKIP[0,1] == 1]
 G91 G01 X-[#108]                     (back off 1/4 the probing distance)
 G31 G91 P2 X[#2] F#112               (Probe X the desired distance at slow feed)
 #104=R_MACH_COOR[0,1]                (GET MACHINE X COORDINATE)
 G91 G01 X-[#108]                     (back off 1/4 the probing distance)
 #106 = [#104+[[#2/abs[#2]]*#105]]    (current position +/- probe radius)

 (STORE X OFFSET FOR WCS ZERO)
 IF [#114 < 1]  
   W_G53G59_COOR[0,#1,1,#106]
 ELSE
   W_G54EXP_COOR[0,#114,1,#106]
 END_IF
ELSE
 MSG_OK["PROBEX", "ERROR: FAILED TO PROBE OBJECT",""]
END_IF

G90

M99
